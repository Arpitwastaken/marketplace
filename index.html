<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marketplace</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #000000;
      --surface: #1c1c1e;
      --surface-secondary: #2c2c2e;
      --surface-tertiary: #3a3a3c;
      --text: #ffffff;
      --text-secondary: #8e8e93;
      --text-tertiary: #636366;
      --accent: #0a84ff;
      --green: #30d158;
      --orange: #ff9f0a;
      --red: #ff453a;
      --purple: #bf5af2;
      --border: #38383a;
      --radius-sm: 10px;
      --radius-md: 14px;
      --radius-lg: 20px;
      --shadow: 0 4px 24px rgba(0,0,0,0.3);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 60px;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
    }
    .logo { font-size: 20px; font-weight: 600; color: var(--text); }
    .header-nav { display: flex; gap: 8px; }
    .nav-btn {
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-btn:hover { color: var(--text); background: var(--surface); }
    .nav-btn.active { color: var(--accent); }
    .main {
      padding-top: 80px;
      padding-bottom: 100px;
      max-width: 1200px;
      margin: 0 auto;
      padding-left: 20px;
      padding-right: 20px;
    }
    .hero {
      background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
      border-radius: var(--radius-lg);
      padding: 48px;
      margin-bottom: 32px;
      text-align: center;
    }
    .hero h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #fff 0%, #8e8e93 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p { font-size: 17px; color: var(--text-secondary); max-width: 500px; margin: 0 auto; }
    .search-container { display: flex; gap: 12px; margin-bottom: 24px; }
    .search-input {
      flex: 1;
      padding: 16px 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 16px;
      color: var(--text);
      transition: all 0.2s;
    }
    .search-input::placeholder { color: var(--text-tertiary); }
    .search-input:focus { outline: none; border-color: var(--accent); background: var(--surface-secondary); }
    .categories {
      display: flex;
      gap: 10px;
      margin-bottom: 28px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    .categories::-webkit-scrollbar { display: none; }
    .category-pill {
      padding: 12px 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }
    .category-pill:hover { background: var(--surface-secondary); color: var(--text); }
    .category-pill.active { background: var(--accent); color: white; border-color: var(--accent); }
    .listings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    .listing-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
      animation: fadeInUp 0.4s ease backwards;
    }
    .listing-card:hover { transform: translateY(-4px); box-shadow: var(--shadow); }
    .card-image { position: relative; height: 200px; background: var(--surface-secondary); overflow: hidden; }
    .card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
    .listing-card:hover .card-image img { transform: scale(1.05); }
    .card-badge { position: absolute; top: 12px; left: 12px; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; text-transform: uppercase; }
    .badge-new { background: var(--green); color: black; }
    .badge-hot { background: var(--red); color: white; }
    .badge-nearby { background: var(--accent); color: white; }
    .card-content { padding: 16px; }
    .card-price { font-size: 24px; font-weight: 700; color: var(--text); }
    .card-title { font-size: 16px; font-weight: 600; margin: 8px 0 4px; color: var(--text); }
    .card-meta { font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; }
    .card-footer { display: flex; align-items: center; justify-content: space-between; padding-top: 12px; border-top: 1px solid var(--border); }
    .seller-info { display: flex; align-items: center; gap: 10px; }
    .seller-avatar {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 600; color: white;
    }
    .seller-name { font-size: 14px; font-weight: 500; }
    .seller-rating { font-size: 13px; color: var(--green); }
    .onboarding {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 9999;
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
      animation: fadeIn 0.4s ease;
    }
    .onboarding.hidden { display: none; }
    .onboarding-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      width: 100%; max-width: 440px;
      padding: 40px;
      text-align: center;
      animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
    }
    .onboarding-icon { font-size: 64px; margin-bottom: 20px; }
    .onboarding-title { font-size: 28px; font-weight: 700; margin-bottom: 12px; }
    .onboarding-desc { font-size: 16px; color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6; }
    .onboarding-progress { display: flex; justify-content: center; gap: 8px; margin-bottom: 32px; }
    .progress-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--surface-tertiary); transition: all 0.3s; }
    .progress-dot.active { background: var(--accent); width: 24px; border-radius: 4px; }
    .onboarding-step { display: none; animation: fadeInUp 0.4s ease; }
    .onboarding-step.active { display: block; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary); }
    .form-input {
      width: 100%; padding: 16px;
      background: var(--surface-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 16px; color: var(--text);
      transition: all 0.2s;
    }
    .form-input:focus { outline: none; border-color: var(--accent); }
    .form-select {
      width: 100%; padding: 16px;
      background: var(--surface-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 16px; color: var(--text);
      cursor: pointer;
    }
    .btn {
      padding: 16px 32px;
      border-radius: var(--radius-md);
      font-size: 16px; font-weight: 600;
      cursor: pointer; transition: all 0.2s;
      border: none;
    }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: #409cff; }
    .btn-secondary { background: var(--surface-tertiary); color: var(--text); }
    .btn-secondary:hover { background: var(--surface-secondary); }
    .btn-full { width: 100%; }
    .detail-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      display: none;
      align-items: center; justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    .detail-overlay.active { display: flex; }
    .detail-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      width: 100%; max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      animation: scaleIn 0.3s ease;
      position: relative;
    }
    .detail-image { width: 100%; height: 350px; object-fit: cover; }
    .detail-content { padding: 32px; }
    .detail-price { font-size: 36px; font-weight: 700; }
    .detail-title { font-size: 24px; font-weight: 600; margin: 12px 0; }
    .detail-condition {
      display: inline-block;
      padding: 6px 14px;
      background: var(--green);
      color: black;
      border-radius: 8px;
      font-size: 13px; font-weight: 600;
    }
    .detail-desc { font-size: 16px; color: var(--text-secondary); margin: 20px 0; line-height: 1.7; }
    .detail-actions { display: flex; gap: 12px; margin-top: 24px; }
    .detail-actions .btn { flex: 1; }
    .close-btn {
      position: absolute; top: 20px; right: 20px;
      width: 40px; height: 40px;
      border-radius: 50%;
      background: var(--surface);
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
      z-index: 10;
    }
    .create-listing { background: var(--surface); border-radius: var(--radius-lg); padding: 32px; margin-bottom: 32px; }
    .create-listing h2 { font-size: 24px; font-weight: 700; margin-bottom: 24px; }
    .image-upload {
      border: 2px dashed var(--border);
      border-radius: var(--radius-md);
      padding: 48px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .image-upload:hover { border-color: var(--accent); background: var(--surface-secondary); }
    .image-upload-icon { font-size: 48px; margin-bottom: 12px; }
    .toast {
      position: fixed; bottom: 30px; left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--surface-secondary);
      color: var(--text);
      padding: 16px 24px;
      border-radius: var(--radius-md);
      font-size: 15px; font-weight: 500;
      z-index: 10000;
      opacity: 0;
      transition: all 0.3s;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-icon { font-size: 64px; margin-bottom: 16px; }
    .empty-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
    .empty-desc { font-size: 15px; color: var(--text-secondary); }
    @media (max-width: 768px) {
      .hero { padding: 32px 20px; }
      .hero h1 { font-size: 28px; }
      .listings-grid { grid-template-columns: 1fr; }
      .detail-actions { flex-direction: column; }
    }
  </style>
</head>
<body>

<!-- ONBOARDING -->
<div class="onboarding" id="onboarding">
  <div class="onboarding-card">
    <button onclick="skipOnboarding()" style="position:absolute;top:16px;right:16px;background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:14px;">Skip</button>
    <div class="onboarding-progress">
      <div class="progress-dot active" id="dot1"></div>
      <div class="progress-dot" id="dot2"></div>
      <div class="progress-dot" id="dot3"></div>
      <div class="progress-dot" id="dot4"></div>
    </div>
    <div class="onboarding-step active" id="step1">
      <div class="onboarding-icon">üõçÔ∏è</div>
      <h2 class="onboarding-title">Welcome to Marketplace</h2>
      <p class="onboarding-desc">The easiest way to buy and sell items in your area. We handle everything.</p>
      <button class="btn btn-primary btn-full" onclick="nextStep(2)">Get Started ‚Üí</button>
    </div>
    <div class="onboarding-step" id="step2">
      <div class="onboarding-icon">üì¶</div>
      <h2 class="onboarding-title">List Once, We Do the Rest</h2>
      <p class="onboarding-desc">Just drop off your items. We list them professionally, find buyers, and handle all the details.</p>
      <button class="btn btn-primary btn-full" onclick="nextStep(3)">How It Works ‚Üí</button>
    </div>
    <div class="onboarding-step" id="step3">
      <div class="onboarding-icon">‚≠ê</div>
      <h2 class="onboarding-title">Trusted by Thousands</h2>
      <p class="onboarding-desc">Every seller is rated. Transactions are secure. Your items are protected.</p>
      <button class="btn btn-primary btn-full" onclick="nextStep(4)">Continue ‚Üí</button>
    </div>
    <div class="onboarding-step" id="step4">
      <div class="onboarding-icon">üëã</div>
      <h2 class="onboarding-title">Let's Get Started</h2>
      <div class="form-group">
        <label class="form-label">Your Name</label>
        <input type="text" class="form-input" id="signupName" placeholder="Enter your name">
      </div>
      <div class="form-group">
        <label class="form-label">Your Zipcode</label>
        <input type="text" class="form-input" id="signupZipcode" placeholder="e.g. 10001">
      </div>
      <button class="btn btn-primary btn-full" onclick="completeSignup()">Create Account</button>
    </div>
  </div>
</div>

<!-- HEADER -->
<header class="header">
  <div class="logo">Marketplace</div>
  <nav class="header-nav">
    <button class="nav-btn active" onclick="showView('browse')" id="navBrowse">Browse</button>
    <button class="nav-btn" onclick="showView('sell')" id="navSell">Sell</button>
    <button class="nav-btn" onclick="showView('account')" id="navAccount">Account</button>
  </nav>
</header>

<!-- MAIN -->
<main class="main" id="mainContent">
  <div id="browseView">
    <div class="hero">
      <h1>Find Great Deals Near You</h1>
      <p>Browse thousands of items from trusted sellers in your area</p>
    </div>
    <div class="search-container">
      <input type="text" class="search-input" placeholder="Search for anything..." id="searchInput" oninput="filterListings()">
    </div>
    <div class="categories" id="categories">
      <button class="category-pill active" onclick="setCategory('all')">All</button>
      <button class="category-pill" onclick="setCategory('electronics')">Electronics</button>
      <button class="category-pill" onclick="setCategory('furniture')">Furniture</button>
      <button class="category-pill" onclick="setCategory('vehicles')">Vehicles</button>
      <button class="category-pill" onclick="setCategory('clothing')">Clothing</button>
      <button class="category-pill" onclick="setCategory('books')">Books</button>
    </div>
    <div class="listings-grid" id="listingsGrid"></div>
  </div>
  
  <div id="sellView" style="display:none;">
    <div class="create-listing">
      <h2>List an Item</h2>
      <div class="form-group">
        <label class="form-label">Photos</label>
        <div class="image-upload" onclick="document.getElementById('imageInput').click()">
          <div class="image-upload-icon">üì∑</div>
          <p>Click to upload photos</p>
          <input type="file" id="imageInput" accept="image/*" multiple style="display:none">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Title</label>
        <input type="text" class="form-input" id="listingTitle" placeholder="What are you selling?">
      </div>
      <div class="form-group">
        <label class="form-label">Description</label>
        <input type="text" class="form-input" id="listingDescription" placeholder="Describe your item...">
      </div>
      <div class="form-group">
        <label class="form-label">Category</label>
        <select class="form-select" id="listingCategory">
          <option value="">Select a category</option>
          <option value="electronics">Electronics</option>
          <option value="furniture">Furniture</option>
          <option value="vehicles">Vehicles</option>
          <option value="clothing">Clothing</option>
          <option value="books">Books</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Price ($)</label>
        <input type="number" class="form-input" id="listingPrice" placeholder="0.00">
      </div>
      <div class="form-group">
        <label class="form-label">Condition</label>
        <select class="form-select" id="listingCondition">
          <option value="">Select condition</option>
          <option value="new">New</option>
          <option value="like_new">Like New</option>
          <option value="good">Good</option>
          <option value="fair">Fair</option>
        </select>
      </div>
      <button class="btn btn-primary btn-full" onclick="createListing()">Post Listing</button>
    </div>
  </div>
  
  <div id="accountView" style="display:none;">
    <div class="create-listing" style="margin-bottom:24px;">
      <h2>Your Account</h2>
      <p style="color:var(--text-secondary);" id="accountName"></p>
    </div>
    <h3 style="font-size:18px;margin-bottom:16px;">Your Listings</h3>
    <div class="listings-grid" id="myListingsGrid"></div>
  </div>
</main>

<!-- DETAIL MODAL -->
<div class="detail-overlay" id="detailOverlay" onclick="closeDetail(event)">
  <div class="detail-card" onclick="event.stopPropagation()">
    <button class="close-btn" onclick="closeDetail()">‚úï</button>
    <img class="detail-image" id="detailImage" src="" alt="">
    <div class="detail-content">
      <div class="detail-price" id="detailPrice"></div>
      <h2 class="detail-title" id="detailTitle"></h2>
      <span class="detail-condition" id="detailCondition"></span>
      <p class="detail-desc" id="detailDesc"></p>
      <p style="color:var(--text-secondary);font-size:14px;" id="detailLocation"></p>
      <div class="detail-actions">
        <button class="btn btn-primary" onclick="contactSeller()">Contact Seller</button>
        <button class="btn btn-secondary" onclick="makeOffer()">Make Offer</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const API = 'http://localhost:3000/api';
let allListings = [];
let currentCategory = 'all';
let searchQuery = '';
let userProfile = null;
let selectedListing = null;

const users = {
  'seller1': { name: 'Tech Trader', initials: 'TT', rating: 4.9 },
  'seller2': { name: 'Gadget Guy', initials: 'GG', rating: 4.5 },
  'seller3': { name: 'Gamer Store', initials: 'GS', rating: 4.8 },
  'seller4': { name: 'Furniture Co', initials: 'FC', rating: 4.7 },
};

let onboardingStep = 1;
function nextStep(step) {
  document.getElementById('step' + onboardingStep).classList.remove('active');
  document.getElementById('dot' + onboardingStep).classList.remove('active');
  onboardingStep = step;
  document.getElementById('step' + onboardingStep).classList.add('active');
  document.getElementById('dot' + onboardingStep).classList.add('active');
}
function skipOnboarding() {
  document.getElementById('onboarding').classList.add('hidden');
  localStorage.setItem('onboardingComplete', 'true');
}
function completeSignup() {
  const name = document.getElementById('signupName').value.trim();
  const zipcode = document.getElementById('signupZipcode').value.trim();
  if (!name) { showToast('Please enter your name'); return; }
  userProfile = { name, zipcode, initials: name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0,2) };
  localStorage.setItem('userProfile', JSON.stringify(userProfile));
  document.getElementById('onboarding').classList.add('hidden');
  showToast('Welcome, ' + name + '!');
}

function showView(view) {
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('nav' + view.charAt(0).toUpperCase() + view.slice(1)).classList.add('active');
  document.getElementById('browseView').style.display = view === 'browse' ? 'block' : 'none';
  document.getElementById('sellView').style.display = view === 'sell' ? 'block' : 'none';
  document.getElementById('accountView').style.display = view === 'account' ? 'block' : 'none';
  if (view === 'account' && userProfile) {
    document.getElementById('accountName').textContent = userProfile.name + ' ‚Ä¢ ' + (userProfile.zipcode || 'No zipcode');
  }
}

async function loadListings() {
  try {
    const res = await fetch(API + '/listings');
    allListings = await res.json();
    renderListings();
  } catch (e) {
    showToast('Could not load listings');
  }
}

function renderListings() {
  let filtered = [...allListings];
  if (currentCategory !== 'all') filtered = filtered.filter(l => l.category === currentCategory);
  if (searchQuery) {
    const q = searchQuery.toLowerCase();
    filtered = filtered.filter(l => l.title.toLowerCase().includes(q) || l.description?.toLowerCase().includes(q));
  }
  filtered = filtered.filter(l => l.type === 'sell');
  
  const grid = document.getElementById('listingsGrid');
  if (filtered.length === 0) {
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üì¶</div><div class="empty-title">No items found</div><div class="empty-desc">Try a different search or category</div></div>';
    return;
  }
  
  grid.innerHTML = filtered.slice(0, 20).map((l, i) => {
    const user = users[l.user_id] || { name: 'Seller', initials: 'S', rating: 4.0 };
    const image = l.image || 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&h=300&fit=crop';
    return `
      <div class="listing-card" onclick="openDetail('${l.id}')" style="animation-delay: ${i * 0.05}s">
        <div class="card-image">
          <img src="${image}" alt="${l.title}" loading="lazy">
          ${l.condition === 'new' ? '<span class="card-badge badge-new">New</span>' : ''}
        </div>
        <div class="card-content">
          <div class="card-price">$${l.price}</div>
          <div class="card-title">${l.title}</div>
          <div class="card-meta">${l.condition?.replace('_', ' ') || 'Used'}</div>
          <div class="card-footer">
            <div class="seller-info">
              <div class="seller-avatar">${user.initials}</div>
              <div><div class="seller-name">${user.name}</div><div class="seller-rating">‚≠ê ${user.rating}</div></div>
            </div>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function setCategory(cat) {
  currentCategory = cat;
  document.querySelectorAll('.category-pill').forEach((p, i) => {
    const cats = ['all', 'electronics', 'furniture', 'vehicles', 'clothing', 'books'];
    p.classList.toggle('active', cats[i] === cat);
  });
  renderListings();
}
function filterListings() {
  searchQuery = document.getElementById('searchInput').value;
  renderListings();
}

function openDetail(id) {
  selectedListing = allListings.find(l => l.id === id);
  if (!selectedListing) return;
  const image = selectedListing.image || 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=400&fit=crop';
  document.getElementById('detailImage').src = image;
  document.getElementById('detailPrice').textContent = '$' + selectedListing.price;
  document.getElementById('detailTitle').textContent = selectedListing.title;
  document.getElementById('detailCondition').textContent = selectedListing.condition?.replace('_', ' ') || 'Used';
  document.getElementById('detailDesc').textContent = selectedListing.description || 'No description provided.';
  document.getElementById('detailLocation').textContent = 'üìç ' + (selectedListing.location || 'Unknown');
  document.getElementById('detailOverlay').classList.add('active');
}
function closeDetail(e) {
  if (!e || e.target === document.getElementById('detailOverlay')) {
    document.getElementById('detailOverlay').classList.remove('active');
  }
}
function contactSeller() { showToast('Opening chat...'); }
function makeOffer() {
  const offer = prompt('Enter your offer amount:');
  if (offer) showToast('Offer sent: $' + offer);
}

async function createListing() {
  const title = document.getElementById('listingTitle').value.trim();
  const description = document.getElementById('listingDescription').value;
  const category = document.getElementById('listingCategory').value;
  const price = document.getElementById('listingPrice').value;
  const condition = document.getElementById('listingCondition').value;
  
  if (!title || !category || !price) { showToast('Please fill in all required fields'); return; }
  
  const listing = {
    type: 'sell', category, title, description,
    price: parseInt(price), condition,
    location: userProfile?.zipcode ? 'Area ' + userProfile.zipcode : 'Local',
    zipcode: userProfile?.zipcode || '',
    tags: [],
    image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&h=300&fit=crop'
  };
  
  try {
    await fetch(API + '/listings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(listing)
    });
    showToast('Listing posted!');
    loadListings();
    showView('browse');
    document.getElementById('listingTitle').value = '';
    document.getElementById('listingDescription').value = '';
    document.getElementById('listingPrice').value = '';
  } catch (e) {
    showToast('Error posting listing');
  }
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// Init
document.addEventListener('DOMContentLoaded', () => {
  if (localStorage.getItem('onboardingComplete') === 'true') {
    document.getElementById('onboarding').classList.add('hidden');
    const saved = localStorage.getItem('userProfile');
    if (saved) userProfile = JSON.parse(saved);
  }
  loadListings();
});
</script>
</body>
</html>
